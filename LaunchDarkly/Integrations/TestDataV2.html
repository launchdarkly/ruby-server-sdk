<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: LaunchDarkly::Integrations::TestDataV2
  
    &mdash; LaunchDarkly Ruby SDK
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "LaunchDarkly::Integrations::TestDataV2";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (T)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../LaunchDarkly.html" title="LaunchDarkly (module)">LaunchDarkly</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Integrations.html" title="LaunchDarkly::Integrations (module)">Integrations</a></span></span>
     &raquo; 
    <span class="title">TestDataV2</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: LaunchDarkly::Integrations::TestDataV2
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">LaunchDarkly::Integrations::TestDataV2</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/ldclient-rb/integrations/test_data_v2.rb<span class="defines">,<br />
  lib/ldclient-rb/integrations/test_data_v2/flag_builder_v2.rb</span>
</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>A mechanism for providing dynamically updatable feature flag state in a
simplified form to an SDK client in test scenarios using the FDv2 protocol.</p>

<p>This type is not stable, and not subject to any backwards
compatibility guarantees or semantic versioning. It is not suitable for production usage.</p>

<p>Do not use it.
You have been warned.</p>

<p>Unlike <span class='object_link'><a href="FileData.html" title="LaunchDarkly::Integrations::FileData (module)">FileData</a></span>, this mechanism does not use any external resources. It
provides only the data that the application has put into it using the <span class='object_link'><a href="#update-instance_method" title="LaunchDarkly::Integrations::TestDataV2#update (method)">#update</a></span> method.</p>

<p>The above example uses a simple boolean flag, but more complex configurations are possible using
the methods of the <span class='object_link'><a href="TestDataV2/FlagBuilderV2.html" title="LaunchDarkly::Integrations::TestDataV2::FlagBuilderV2 (class)">FlagBuilderV2</a></span> that is returned by <span class='object_link'><a href="#flag-instance_method" title="LaunchDarkly::Integrations::TestDataV2#flag (method)">#flag</a></span>. <span class='object_link'><a href="TestDataV2/FlagBuilderV2.html" title="LaunchDarkly::Integrations::TestDataV2::FlagBuilderV2 (class)">FlagBuilderV2</a></span>
supports many of the ways a flag can be configured on the LaunchDarkly dashboard, but does not
currently support 1. rule operators other than &quot;in&quot; and &quot;not in&quot;, or 2. percentage rollouts.</p>

<p>If the same <code>TestDataV2</code> instance is used to configure multiple <code>LDClient</code> instances,
any changes made to the data will propagate to all of the <code>LDClient</code> instances.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ldclient-rb/integrations/test_data_v2</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_td'>td</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../LaunchDarkly.html" title="LaunchDarkly (module)">LaunchDarkly</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Integrations.html" title="LaunchDarkly::Integrations (module)">Integrations</a></span></span><span class='op'>::</span><span class='const'>TestDataV2</span><span class='period'>.</span><span class='id identifier rubyid_data_source'><span class='object_link'><a href="#data_source-class_method" title="LaunchDarkly::Integrations::TestDataV2.data_source (method)">data_source</a></span></span>
<span class='id identifier rubyid_td'>td</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_td'>td</span><span class='period'>.</span><span class='id identifier rubyid_flag'>flag</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>flag-key-1</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_variation_for_all'>variation_for_all</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span><span class='rparen'>)</span>

<span class='comment'># Configure the data system with TestDataV2 as both initializer and synchronizer
</span><span class='comment'># Note: This example assumes FDv2 data system configuration is available
</span><span class='comment'># data_config = LaunchDarkly::Impl::DataSystem::Config.custom
</span><span class='comment'># data_config.initializers([td.method(:build_initializer)])
</span><span class='comment'># data_config.synchronizers(td.method(:build_synchronizer))
</span>
<span class='comment'># config = LaunchDarkly::Config.new(
</span><span class='comment'>#   sdk_key,
</span><span class='comment'>#   datasystem_config: data_config.build
</span><span class='comment'># )
</span>
<span class='comment'># flags can be updated at any time:
</span><span class='id identifier rubyid_td'>td</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_td'>td</span><span class='period'>.</span><span class='id identifier rubyid_flag'>flag</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>flag-key-1</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='period'>.</span><span class='id identifier rubyid_variation_for_user'>variation_for_user</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>some-user-key</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='period'>.</span><span class='id identifier rubyid_fallthrough_variation'>fallthrough_variation</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span><span class='rparen'>)</span></code></pre>
    
  </div>


</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="TestDataV2/FlagBuilderV2.html" title="LaunchDarkly::Integrations::TestDataV2::FlagBuilderV2 (class)">FlagBuilderV2</a></span>, <span class='object_link'><a href="TestDataV2/FlagRuleBuilderV2.html" title="LaunchDarkly::Integrations::TestDataV2::FlagRuleBuilderV2 (class)">FlagRuleBuilderV2</a></span>
    
  
</p>

  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="TRUE_VARIATION_INDEX-constant" class="">TRUE_VARIATION_INDEX =
          <div class="docstring">
  <div class="discussion">
    <p>Constants for boolean flag variation indices</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0</span></pre></dd>
      
        <dt id="FALSE_VARIATION_INDEX-constant" class="">FALSE_VARIATION_INDEX =
          
        </dt>
        <dd><pre class="code"><span class='int'>1</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#data_source-class_method" title="data_source (class method)">.<strong>data_source</strong>  &#x21d2; TestDataV2 </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates a new instance of the test data source.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#variation_for_boolean-class_method" title="variation_for_boolean (class method)">.<strong>variation_for_boolean</strong>(variation)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_instance-instance_method" title="#add_instance (instance method)">#<strong>add_instance</strong>(instance)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_initializer-instance_method" title="#build_initializer (instance method)">#<strong>build_initializer</strong>(sdk_key, config)  &#x21d2; LaunchDarkly::Impl::Integrations::TestData::TestDataSourceV2 </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates an initializer that can be used with the FDv2 data system.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_synchronizer-instance_method" title="#build_synchronizer (instance method)">#<strong>build_synchronizer</strong>(sdk_key, config)  &#x21d2; LaunchDarkly::Impl::Integrations::TestData::TestDataSourceV2 </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates a synchronizer that can be used with the FDv2 data system.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#closed_instance-instance_method" title="#closed_instance (instance method)">#<strong>closed_instance</strong>(instance)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#flag-instance_method" title="#flag (instance method)">#<strong>flag</strong>(key)  &#x21d2; FlagBuilderV2 </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates or copies a <span class='object_link'><a href="TestDataV2/FlagBuilderV2.html" title="LaunchDarkly::Integrations::TestDataV2::FlagBuilderV2 (class)">FlagBuilderV2</a></span> for building a test flag configuration.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_version-instance_method" title="#get_version (instance method)">#<strong>get_version</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>  &#x21d2; TestDataV2 </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'><p>A new instance of TestDataV2.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#make_init_data-instance_method" title="#make_init_data (instance method)">#<strong>make_init_data</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-instance_method" title="#update (instance method)">#<strong>update</strong>(flag_builder)  &#x21d2; TestDataV2 </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Updates the test data with the specified flag configuration.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#use_preconfigured_segment-instance_method" title="#use_preconfigured_segment (instance method)">#<strong>use_preconfigured_segment</strong>(segment)  &#x21d2; TestDataV2 </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Copies a full segment data model object into the test data.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>  &#x21d2; <tt><span class='object_link'><a href="" title="LaunchDarkly::Integrations::TestDataV2 (class)">TestDataV2</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>
<p>Returns a new instance of TestDataV2.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


60
61
62
63
64
65
66
67</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ldclient-rb/integrations/test_data_v2.rb', line 60</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
  <span class='ivar'>@flag_builders</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@current_flags</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@current_segments</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@lock</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>ReadWriteLock</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@instances</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@version</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="data_source-class_method">
  
    .<strong>data_source</strong>  &#x21d2; <tt><span class='object_link'><a href="" title="LaunchDarkly::Integrations::TestDataV2 (class)">TestDataV2</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Creates a new instance of the test data source.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="LaunchDarkly::Integrations::TestDataV2 (class)">TestDataV2</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>a new configurable test data source</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


55
56
57</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ldclient-rb/integrations/test_data_v2.rb', line 55</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_data_source'>data_source</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="variation_for_boolean-class_method">
  
    .<strong>variation_for_boolean</strong>(variation)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


13
14
15</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ldclient-rb/integrations/test_data_v2/flag_builder_v2.rb', line 13</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_variation_for_boolean'>variation_for_boolean</span><span class='lparen'>(</span><span class='id identifier rubyid_variation'>variation</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_variation'>variation</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="#TRUE_VARIATION_INDEX-constant" title="LaunchDarkly::Integrations::TestDataV2::TRUE_VARIATION_INDEX (constant)">TRUE_VARIATION_INDEX</a></span></span> <span class='op'>:</span> <span class='const'><span class='object_link'><a href="#FALSE_VARIATION_INDEX-constant" title="LaunchDarkly::Integrations::TestDataV2::FALSE_VARIATION_INDEX (constant)">FALSE_VARIATION_INDEX</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_instance-instance_method">
  
    #<strong>add_instance</strong>(instance)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>instance</span>
      
      
        <span class='type'>(<tt>LaunchDarkly::Impl::Integrations::TestData::TestDataSourceV2</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the TestDataSourceV2 instance to add</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


168
169
170
171
172</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ldclient-rb/integrations/test_data_v2.rb', line 168</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_instance'>add_instance</span><span class='lparen'>(</span><span class='id identifier rubyid_instance'>instance</span><span class='rparen'>)</span>
  <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_with_write_lock'>with_write_lock</span> <span class='kw'>do</span>
    <span class='ivar'>@instances</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_instance'>instance</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="build_initializer-instance_method">
  
    #<strong>build_initializer</strong>(sdk_key, config)  &#x21d2; <tt>LaunchDarkly::Impl::Integrations::TestData::TestDataSourceV2</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Creates an initializer that can be used with the FDv2 data system.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>sdk_key</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the SDK key</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>config</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Config.html" title="LaunchDarkly::Config (class)">LaunchDarkly::Config</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the SDK configuration</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>LaunchDarkly::Impl::Integrations::TestData::TestDataSourceV2</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>a test data initializer</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


231
232
233</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ldclient-rb/integrations/test_data_v2.rb', line 231</span>

<span class='kw'>def</span> <span class='id identifier rubyid_build_initializer'>build_initializer</span><span class='lparen'>(</span><span class='id identifier rubyid_sdk_key'>sdk_key</span><span class='comma'>,</span> <span class='id identifier rubyid_config'>config</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../../LaunchDarkly.html" title="LaunchDarkly (module)">LaunchDarkly</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Impl.html" title="LaunchDarkly::Impl (module)">Impl</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Impl/Integrations.html" title="LaunchDarkly::Impl::Integrations (module)">Integrations</a></span></span><span class='op'>::</span><span class='const'>TestData</span><span class='op'>::</span><span class='const'>TestDataSourceV2</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="build_synchronizer-instance_method">
  
    #<strong>build_synchronizer</strong>(sdk_key, config)  &#x21d2; <tt>LaunchDarkly::Impl::Integrations::TestData::TestDataSourceV2</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Creates a synchronizer that can be used with the FDv2 data system.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>sdk_key</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the SDK key</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>config</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Config.html" title="LaunchDarkly::Config (class)">LaunchDarkly::Config</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the SDK configuration</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>LaunchDarkly::Impl::Integrations::TestData::TestDataSourceV2</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>a test data synchronizer</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


242
243
244</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ldclient-rb/integrations/test_data_v2.rb', line 242</span>

<span class='kw'>def</span> <span class='id identifier rubyid_build_synchronizer'>build_synchronizer</span><span class='lparen'>(</span><span class='id identifier rubyid_sdk_key'>sdk_key</span><span class='comma'>,</span> <span class='id identifier rubyid_config'>config</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../../LaunchDarkly.html" title="LaunchDarkly (module)">LaunchDarkly</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Impl.html" title="LaunchDarkly::Impl (module)">Impl</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Impl/Integrations.html" title="LaunchDarkly::Impl::Integrations (module)">Integrations</a></span></span><span class='op'>::</span><span class='const'>TestData</span><span class='op'>::</span><span class='const'>TestDataSourceV2</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="closed_instance-instance_method">
  
    #<strong>closed_instance</strong>(instance)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>instance</span>
      
      
        <span class='type'>(<tt>LaunchDarkly::Impl::Integrations::TestData::TestDataSourceV2</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the TestDataSourceV2 instance to remove</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


160
161
162
163
164</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ldclient-rb/integrations/test_data_v2.rb', line 160</span>

<span class='kw'>def</span> <span class='id identifier rubyid_closed_instance'>closed_instance</span><span class='lparen'>(</span><span class='id identifier rubyid_instance'>instance</span><span class='rparen'>)</span>
  <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_with_write_lock'>with_write_lock</span> <span class='kw'>do</span>
    <span class='ivar'>@instances</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_instance'>instance</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@instances</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_instance'>instance</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="flag-instance_method">
  
    #<strong>flag</strong>(key)  &#x21d2; <tt><span class='object_link'><a href="TestDataV2/FlagBuilderV2.html" title="LaunchDarkly::Integrations::TestDataV2::FlagBuilderV2 (class)">FlagBuilderV2</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Creates or copies a <span class='object_link'><a href="TestDataV2/FlagBuilderV2.html" title="LaunchDarkly::Integrations::TestDataV2::FlagBuilderV2 (class)">FlagBuilderV2</a></span> for building a test flag configuration.</p>

<p>If this flag key has already been defined in this <code>TestDataV2</code> instance, then the builder
starts with the same configuration that was last provided for this flag.</p>

<p>Otherwise, it starts with a new default configuration in which the flag has <code>true</code> and
<code>false</code> variations, is <code>true</code> for all contexts when targeting is turned on and
<code>false</code> otherwise, and currently has targeting turned on. You can change any of those
properties, and provide more complex behavior, using the <span class='object_link'><a href="TestDataV2/FlagBuilderV2.html" title="LaunchDarkly::Integrations::TestDataV2::FlagBuilderV2 (class)">FlagBuilderV2</a></span> methods.</p>

<p>Once you have set the desired configuration, pass the builder to <span class='object_link'><a href="#update-instance_method" title="LaunchDarkly::Integrations::TestDataV2#update (method)">#update</a></span>.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the flag key</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="TestDataV2/FlagBuilderV2.html" title="LaunchDarkly::Integrations::TestDataV2::FlagBuilderV2 (class)">FlagBuilderV2</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>a flag configuration builder</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


85
86
87
88
89
90
91
92
93
94
95
96
97
98
99</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ldclient-rb/integrations/test_data_v2.rb', line 85</span>

<span class='kw'>def</span> <span class='id identifier rubyid_flag'>flag</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_existing_builder'>existing_builder</span> <span class='op'>=</span> <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_with_read_lock'>with_read_lock</span> <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='ivar'>@flag_builders</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='ivar'>@flag_builders</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='ivar'>@flag_builders</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span>
    <span class='kw'>else</span>
      <span class='kw'>nil</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_existing_builder'>existing_builder</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='const'><span class='object_link'><a href="../../LaunchDarkly.html" title="LaunchDarkly (module)">LaunchDarkly</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Integrations.html" title="LaunchDarkly::Integrations (module)">Integrations</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="LaunchDarkly::Integrations::TestDataV2 (class)">TestDataV2</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="TestDataV2/FlagBuilderV2.html" title="LaunchDarkly::Integrations::TestDataV2::FlagBuilderV2 (class)">FlagBuilderV2</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="TestDataV2/FlagBuilderV2.html#initialize-instance_method" title="LaunchDarkly::Integrations::TestDataV2::FlagBuilderV2#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_boolean_flag'><span class='object_link'><a href="TestDataV2/FlagBuilderV2.html#boolean_flag-instance_method" title="LaunchDarkly::Integrations::TestDataV2::FlagBuilderV2#boolean_flag (method)">boolean_flag</a></span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_existing_builder'>existing_builder</span><span class='period'>.</span><span class='id identifier rubyid_clone'>clone</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_version-instance_method">
  
    #<strong>get_version</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


150
151
152
153
154
155
156</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ldclient-rb/integrations/test_data_v2.rb', line 150</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_version'>get_version</span>
  <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_with_write_lock'>with_write_lock</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_version'>version</span> <span class='op'>=</span> <span class='ivar'>@version</span>
    <span class='ivar'>@version</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_version'>version</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="make_init_data-instance_method">
  
    #<strong>make_init_data</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


140
141
142
143
144
145
146
147</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ldclient-rb/integrations/test_data_v2.rb', line 140</span>

<span class='kw'>def</span> <span class='id identifier rubyid_make_init_data'>make_init_data</span>
  <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_with_read_lock'>with_read_lock</span> <span class='kw'>do</span>
    <span class='lbrace'>{</span>
      <span class='label'>flags:</span> <span class='ivar'>@current_flags</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span><span class='comma'>,</span>
      <span class='label'>segments:</span> <span class='ivar'>@current_segments</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span><span class='comma'>,</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update-instance_method">
  
    #<strong>update</strong>(flag_builder)  &#x21d2; <tt><span class='object_link'><a href="" title="LaunchDarkly::Integrations::TestDataV2 (class)">TestDataV2</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Updates the test data with the specified flag configuration.</p>

<p>This has the same effect as if a flag were added or modified on the LaunchDarkly dashboard.
It immediately propagates the flag change to any <code>LDClient</code> instance(s) that you have
already configured to use this <code>TestDataV2</code>. If no <code>LDClient</code> has been started yet,
it simply adds this flag to the test data which will be provided to any <code>LDClient</code> that
you subsequently configure.</p>

<p>Any subsequent changes to this <span class='object_link'><a href="TestDataV2/FlagBuilderV2.html" title="LaunchDarkly::Integrations::TestDataV2::FlagBuilderV2 (class)">FlagBuilderV2</a></span> instance do not affect the test data,
unless you call <span class='object_link'><a href="#update-instance_method" title="LaunchDarkly::Integrations::TestDataV2#update (method)">#update</a></span> again.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>flag_builder</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="TestDataV2/FlagBuilderV2.html" title="LaunchDarkly::Integrations::TestDataV2::FlagBuilderV2 (class)">FlagBuilderV2</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>a flag configuration builder</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="LaunchDarkly::Integrations::TestDataV2 (class)">TestDataV2</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the TestDataV2 instance</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ldclient-rb/integrations/test_data_v2.rb', line 116</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_flag_builder'>flag_builder</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_instances_copy'>instances_copy</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_new_flag'>new_flag</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_with_write_lock'>with_write_lock</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_old_flag'>old_flag</span> <span class='op'>=</span> <span class='ivar'>@current_flags</span><span class='lbracket'>[</span><span class='id identifier rubyid_flag_builder'>flag_builder</span><span class='period'>.</span><span class='id identifier rubyid__key'>_key</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_old_version'>old_version</span> <span class='op'>=</span> <span class='id identifier rubyid_old_flag'>old_flag</span> <span class='op'>?</span> <span class='id identifier rubyid_old_flag'>old_flag</span><span class='lbracket'>[</span><span class='symbol'>:version</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='int'>0</span>

    <span class='id identifier rubyid_new_flag'>new_flag</span> <span class='op'>=</span> <span class='id identifier rubyid_flag_builder'>flag_builder</span><span class='period'>.</span><span class='id identifier rubyid_build'>build</span><span class='lparen'>(</span><span class='id identifier rubyid_old_version'>old_version</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span>

    <span class='ivar'>@current_flags</span><span class='lbracket'>[</span><span class='id identifier rubyid_flag_builder'>flag_builder</span><span class='period'>.</span><span class='id identifier rubyid__key'>_key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_new_flag'>new_flag</span>
    <span class='ivar'>@flag_builders</span><span class='lbracket'>[</span><span class='id identifier rubyid_flag_builder'>flag_builder</span><span class='period'>.</span><span class='id identifier rubyid__key'>_key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_flag_builder'>flag_builder</span><span class='period'>.</span><span class='id identifier rubyid_clone'>clone</span>

    <span class='comment'># Create a copy of instances while holding the lock to avoid race conditions
</span>    <span class='id identifier rubyid_instances_copy'>instances_copy</span> <span class='op'>=</span> <span class='ivar'>@instances</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_instances_copy'>instances_copy</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_instance'>instance</span><span class='op'>|</span>
    <span class='id identifier rubyid_instance'>instance</span><span class='period'>.</span><span class='id identifier rubyid_upsert_flag'>upsert_flag</span><span class='lparen'>(</span><span class='id identifier rubyid_new_flag'>new_flag</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="use_preconfigured_segment-instance_method">
  
    #<strong>use_preconfigured_segment</strong>(segment)  &#x21d2; <tt><span class='object_link'><a href="" title="LaunchDarkly::Integrations::TestDataV2 (class)">TestDataV2</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Copies a full segment data model object into the test data.</p>

<p>It immediately propagates the change to any <code>LDClient</code> instance(s) that you have already
configured to use this <code>TestDataV2</code>. If no <code>LDClient</code> has been started yet, it simply adds
this segment to the test data which will be provided to any LDClient that you subsequently
configure.</p>

<p>This method is currently the only way to inject segment data, since there is no builder
API for segments. It is mainly intended for the SDK&#39;s own tests of segment functionality,
since application tests that need to produce a desired evaluation state could do so more easily
by just setting flag values.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>segment</span>
      
      
        <span class='type'>(<tt>Hash</tt>, <tt><span class='object_link'><a href="../Impl/Model/Segment.html" title="LaunchDarkly::Impl::Model::Segment (class)">LaunchDarkly::Impl::Model::Segment</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the segment configuration as a hash or
a Segment model object.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="LaunchDarkly::Integrations::TestDataV2 (class)">TestDataV2</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the TestDataV2 instance</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ldclient-rb/integrations/test_data_v2.rb', line 191</span>

<span class='kw'>def</span> <span class='id identifier rubyid_use_preconfigured_segment'>use_preconfigured_segment</span><span class='lparen'>(</span><span class='id identifier rubyid_segment'>segment</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_instances_copy'>instances_copy</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_segment_key'>segment_key</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_updated_segment'>updated_segment</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_with_write_lock'>with_write_lock</span> <span class='kw'>do</span>
    <span class='comment'># Convert to hash and normalize keys to symbols
</span>    <span class='id identifier rubyid_segment_hash'>segment_hash</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_segment'>segment</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_segment'>segment</span><span class='period'>.</span><span class='id identifier rubyid_transform_keys'>transform_keys</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_sym</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_segment'>segment</span><span class='period'>.</span><span class='id identifier rubyid_as_json'>as_json</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_segment_key'>segment_key</span> <span class='op'>=</span> <span class='id identifier rubyid_segment_hash'>segment_hash</span><span class='lbracket'>[</span><span class='symbol'>:key</span><span class='rbracket'>]</span>

    <span class='id identifier rubyid_old_segment'>old_segment</span> <span class='op'>=</span> <span class='ivar'>@current_segments</span><span class='lbracket'>[</span><span class='id identifier rubyid_segment_key'>segment_key</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_old_version'>old_version</span> <span class='op'>=</span> <span class='id identifier rubyid_old_segment'>old_segment</span> <span class='op'>?</span> <span class='id identifier rubyid_old_segment'>old_segment</span><span class='lbracket'>[</span><span class='symbol'>:version</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='int'>0</span>

    <span class='id identifier rubyid_updated_segment'>updated_segment</span> <span class='op'>=</span> <span class='id identifier rubyid_segment_hash'>segment_hash</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
    <span class='id identifier rubyid_updated_segment'>updated_segment</span><span class='lbracket'>[</span><span class='symbol'>:version</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_old_version'>old_version</span> <span class='op'>+</span> <span class='int'>1</span>

    <span class='ivar'>@current_segments</span><span class='lbracket'>[</span><span class='id identifier rubyid_segment_key'>segment_key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_segment'>updated_segment</span>

    <span class='comment'># Create a copy of instances while holding the lock to avoid race conditions
</span>    <span class='id identifier rubyid_instances_copy'>instances_copy</span> <span class='op'>=</span> <span class='ivar'>@instances</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_instances_copy'>instances_copy</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_instance'>instance</span><span class='op'>|</span>
    <span class='id identifier rubyid_instance'>instance</span><span class='period'>.</span><span class='id identifier rubyid_upsert_segment'>upsert_segment</span><span class='lparen'>(</span><span class='id identifier rubyid_updated_segment'>updated_segment</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Jan 20 18:49:29 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-3.2.10).
</div>

    </div>
  </body>
</html>